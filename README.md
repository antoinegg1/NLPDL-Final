# NLPFINAL Project

This repository is the final project repository of PKU NLPDL Course (24FALL), which contains the codebase for fine-tuning, pretraining, evaluating, and generating results for natural language processing (NLP) tasks. The structure is modular to support flexible experimentation and development. In addition, the trained models and datasets are uploaded in [Huggingface Repository](https://huggingface.co/datasets/Antoinegg1/NLPFINALHF).

## Repository Structure

```plaintext
NLPFINAL/
├── evaluate/
│   ├── evaluate_with_AI.py       # Evaluate models with additional AI-assisted metrics
│   └── evaluate.py               # General evaluation script
├── fine-tuning_deepspeed/
│   ├── ds_config.json            # Configuration file for DeepSpeed
│   ├── model.py                  # Defines the model architecture
│   ├── sft.sh                    # Shell script for running fine-tuning with DeepSpeed
│   ├── supervised_dataset.py     # Script for preparing the supervised dataset
│   └── train.py                  # Main training script for DeepSpeed fine-tuning
├── fine-tuning_torchrun/
│   ├── main.py                   # Entry point for the fine-tuning process
│   ├── model.py                  # Defines the model architecture
│   ├── supervised_dataset.py     # Script for preparing the supervised dataset
│   └── trainer.py                # Core training script for managing the fine-tuning process
├── generate/
│   ├── generate_test_t5.py       # Script for generating results with T5 models
│   └── generate_test.py          # General script for generating results with any model
├── pretrain/
│   ├── ds_config.json            # Configuration file for DeepSpeed during pretraining
│   ├── pre-train.py              # Script for model pretraining
│   └── train.sh                  # Shell script for running the pretraining process
├── result/
│   ├── AI_eval_result/           # Stores evaluation results with AI-assisted metrics
│   └── Generate_result/          # Stores outputs generated by the models
├── tutorial/
│   └── style_transfer.py         # Example script for performing style transfer tasks
├── util/
│   ├── create_dataset.py         # Script for dataset creation
│   ├── data_clear.py             # Script for cleaning and preprocessing data
│   └── util.py                   # General utility functions used across the repository
```

## Setup Instructions

```bash
pip install -r requirements.txt
```

## Usage

### Pretraining

```bash
cd pretrain
bash train.sh
```

### Fine-tuning

```bash
# Using DeepSpeed
cd fine-tuning_deepspeed
bash sft.sh

# Using TorchRun
cd fine-tuning_torchrun
python main.py
```

### Evaluation

```bash
# Evaluate with Automatic Metrics
cd evaluate
python evaluate.py

# Evaluate with AI Feedback
cd evaluate
python evaluate_with_AI.py
```

## Generation

```bash
# Generate results using the models
cd generate
python generate_test.py
```